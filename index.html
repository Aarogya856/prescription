<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Previous head content remains exactly the same -->
    <!-- ... -->
</head>
<body>
    <!-- All your existing HTML remains exactly the same until the PDF templates -->
    <!-- ... -->

    <!-- PDF Templates (hidden) -->
    <!-- Prescription Template (NO CHANGES) -->
    <div id="prescription-template" class="pdf-template">
        <!-- Keep existing prescription template exactly as is -->
        <!-- ... -->
    </div>
    
    <!-- Modified Diet Chart Template -->
    <div id="diet-template" class="pdf-template" style="padding-bottom: 40mm;">
        <div class="diet-pdf">
            <div class="pdf-header">
                <div>
                    <img src="logo.png" class="pdf-logo" alt="Clinic Logo">
                </div>
                <div class="clinic-info">
                    <h2 style="color: var(--clinic-orange);">Aarogya Aahar</h2>
                    <p><i class="fas fa-map-marker-alt"></i> SCF 10, New Aggar Nagar, Ludhiana</p>
                    <p><i class="fas fa-phone"></i> +91 98885 31577</p>
                </div>
            </div>
            
            <div class="pdf-title">
                <h1 style="margin: 10px 0;">DIET CHART</h1>
            </div>
            
            <div class="prescription-date">
                Date: <span id="pdf-diet-date"></span>
            </div>
            
            <div class="diet-patient-info">
                <div class="info-row">
                    <span class="info-label">Patient Name:</span>
                    <span class="info-value" id="pdf-diet-patient-name"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Age:</span>
                    <span class="info-value" id="pdf-diet-patient-age"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Health Condition:</span>
                    <span class="info-value" id="pdf-diet-condition"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Duration:</span>
                    <span class="info-value" id="pdf-diet-duration"></span> weeks
                </div>
            </div>
            
            <div class="diet-table-section" style="page-break-inside: avoid;">
                <table id="pdf-diet-table" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="padding: 8px; border: 1px solid #ddd; background-color: var(--primary); color: white;">Day/Time</th>
                            <th style="padding: 8px; border: 1px solid #ddd; background-color: var(--primary); color: white;">Morning</th>
                            <th style="padding: 8px; border: 1px solid #ddd; background-color: var(--primary); color: white;">Breakfast</th>
                            <th style="padding: 8px; border: 1px solid #ddd; background-color: var(--primary); color: white;">Mid-Meal</th>
                            <th style="padding: 8px; border: 1px solid #ddd; background-color: var(--primary); color: white;">Lunch</th>
                            <th style="padding: 8px; border: 1px solid #ddd; background-color: var(--primary); color: white;">Evening</th>
                            <th style="padding: 8px; border: 1px solid #ddd; background-color: var(--primary); color: white;">Dinner</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="diet-notes" style="page-break-after: avoid;">
                <h4>Additional Notes:</h4>
                <p id="pdf-diet-notes"></p>
            </div>
            
            <div class="doctor-signature" style="margin-top: 30px; page-break-inside: avoid;">
                <img src="signature.png" class="pdf-signature" alt="Doctor Signature" style="height: 60px; margin-bottom: 10px;">
                <div class="doctor-info" style="text-align: right;">
                    <h4>Dr. Riya Sharma</h4>
                    <p>BHMS</p>
                    <p>Certified Nutritionist</p>
                </div>
            </div>
            
            <div class="pdf-footer" style="margin-top: auto; padding: 20px 0; position: relative; bottom: 0;">
                <span><i class="fab fa-instagram"></i> @aarogya.aahar</span>
                <span><i class="fab fa-facebook"></i> @aarogya.aahar</span>
                <span><i class="fas fa-envelope"></i> aarogyaaahar4@gmail.com</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const { jsPDF } = window.jspdf;
            
            // ... (keep all existing JavaScript functions the same until generateDietPDF)
            
            function generateDietPDF() {
                // Get form data
                const patientName = document.getElementById('diet-patient-name').value;
                const patientAge = document.getElementById('diet-patient-age').value;
                const condition = document.getElementById('diet-condition').value;
                const duration = document.getElementById('diet-duration').value;
                const dietNotes = document.getElementById('diet-notes').value;
                
                // Validate required fields
                if (!patientName || !patientAge || !condition || !duration) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Update the PDF template
                const today = new Date();
                document.getElementById('pdf-diet-date').textContent = formatDate(today.toISOString().split('T')[0]);
                document.getElementById('pdf-diet-patient-name').textContent = patientName;
                document.getElementById('pdf-diet-patient-age').textContent = patientAge;
                document.getElementById('pdf-diet-condition').textContent = condition;
                document.getElementById('pdf-diet-duration').textContent = duration;
                document.getElementById('pdf-diet-notes').textContent = dietNotes || '--';
                
                // Populate diet table in PDF
                const pdfDietTable = document.querySelector('#pdf-diet-table tbody');
                pdfDietTable.innerHTML = '';
                
                const rows = document.querySelectorAll('#diet-table tbody tr');
                rows.forEach(row => {
                    const newRow = document.createElement('tr');
                    
                    // Day cell
                    const dayCell = document.createElement('td');
                    dayCell.textContent = row.cells[0].textContent;
                    dayCell.style.padding = '8px';
                    dayCell.style.border = '1px solid #ddd';
                    newRow.appendChild(dayCell);
                    
                    // Time cells (6 columns now)
                    for (let i = 1; i < 7; i++) {
                        const timeCell = document.createElement('td');
                        timeCell.textContent = row.cells[i].querySelector('textarea').value || '--';
                        timeCell.style.padding = '8px';
                        timeCell.style.border = '1px solid #ddd';
                        newRow.appendChild(timeCell);
                    }
                    
                    pdfDietTable.appendChild(newRow);
                });
                
                // Generate PDF with multi-page support
                const element = document.getElementById('diet-template');
                
                html2canvas(element, {
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    scrollX: 0,
                    scrollY: 0,
                    windowHeight: element.scrollHeight + 200
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 210;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    // Add first page
                    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                    
                    // Add additional pages if needed
                    let heightLeft = imgHeight;
                    let position = 0;
                    const pageHeight = 297; // A4 height in mm
                    
                    while (heightLeft >= 0) {
                        position = heightLeft - pageHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdf.save(`Diet_Chart_${patientName.replace(/\s/g, '_')}_${formatDate(today.toISOString().split('T')[0])}.pdf`);
                });
            }
            
            // ... (keep all remaining JavaScript functions exactly the same)
        });
    </script>
</body>
</html>
